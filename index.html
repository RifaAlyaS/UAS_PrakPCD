<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image RGB & HSV Converter</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0b0f17;
            --bg-2: #0f1522;
            --card: rgba(255,255,255,0.04);
            --border: rgba(255,255,255,0.08);
            --text: #e5e7eb;
            --muted: #9ca3af;
            --accent: #22d3ee;
            --accent-2: #a78bfa;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Plus Jakarta Sans', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif;
            background: radial-gradient(1200px 600px at 10% 0%, rgba(167,139,250,0.12) 0%, transparent 60%),
                        radial-gradient(1000px 500px at 90% 20%, rgba(34,211,238,0.12) 0%, transparent 60%),
                        linear-gradient(180deg, var(--bg), var(--bg-2));
            color: var(--text);
            min-height: 100vh;
            padding: 0 24px 24px 24px; /* header scrolls with content, no extra top gap */
        }

        .site-header {
            position: static; /* header will scroll with content */
            z-index: 50;
            background:
                linear-gradient(135deg, rgba(34,211,238,0.18) 0%, rgba(167,139,250,0.18) 100%),
                linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.04));
            border: 1px solid rgba(34,211,238,0.25);
            border-radius: 12px;
            padding: 18px 20px;
            backdrop-filter: blur(8px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.25), 0 6px 20px rgba(167,139,250,0.18);
            margin-bottom: 18px;
        }
        .site-header__inner {
            max-width: 1200px;
            margin: 0 auto;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
            border-radius: 16px;
            padding: 28px;
            border: 1px solid var(--border);
            backdrop-filter: blur(8px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.35);
        }

        h1 {
            text-align: center;
            color: var(--text);
            margin-bottom: 8px;
            font-size: 2.3em;
            font-weight: 700;
            letter-spacing: 0.2px;
        }

        .subtitle {
            text-align: center;
            color: var(--muted);
            margin-bottom: 28px;
            font-size: 0.98em;
        }

        .layout {
            display: flex;
            gap: 24px;
            align-items: flex-start;
        }

        .sidebar {
            width: 320px;
            flex: 0 0 320px;
            position: sticky;
            top: 24px;
            align-self: flex-start;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 18px;
        }

        .content {
            flex: 1;
        }

        .upload-section {
            text-align: center;
            margin-bottom: 20px;
        }

        .upload-box {
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 28px;
            background: var(--card);
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s, box-shadow 0.2s;
        }

        .upload-box:hover {
            background: rgba(255,255,255,0.06);
            border-color: rgba(255,255,255,0.15);
            box-shadow: 0 8px 24px rgba(167,139,250,0.15), 0 8px 24px rgba(34,211,238,0.12);
        }

        .upload-box.dragover {
            background: rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.25);
        }

        input[type="file"] {
            display: none;
        }

        .upload-btn {
            background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
            color: #0b0f17;
            padding: 12px 26px;
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 14px;
            cursor: pointer;
            font-family: 'Sora', 'Plus Jakarta Sans', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial;
            font-size: 15px;
            font-weight: 700;
            letter-spacing: 0.2px;
            transition: transform 0.15s ease, box-shadow 0.2s ease, filter 0.2s ease;
            box-shadow: 0 10px 24px rgba(167,139,250,0.35), 0 10px 24px rgba(34,211,238,0.28);
            backdrop-filter: blur(4px);
        }

        .upload-btn:hover {
            transform: translateY(-1px) scale(1.03);
            box-shadow: 0 16px 34px rgba(167,139,250,0.5), 0 16px 34px rgba(34,211,238,0.42);
            filter: saturate(1.05);
        }

        .upload-btn:active {
            transform: translateY(0) scale(0.99);
            box-shadow: 0 8px 20px rgba(167,139,250,0.35), 0 8px 20px rgba(34,211,238,0.3);
        }

        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
            color: var(--muted);
            font-size: 16px;
        }

        .spinner {
            border: 3px solid rgba(255,255,255,0.15);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
            margin: 16px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .results {
            display: none;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.3em;
            color: var(--text);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.08);
            font-weight: 600;
        }

        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .image-card {
            background: var(--card);
            border-radius: 12px;
            padding: 12px;
            border: 1px solid var(--border);
            backdrop-filter: blur(6px);
        }

        .image-card h3 {
            color: var(--text);
            margin-bottom: 8px;
            font-size: 1.02em;
            font-weight: 600;
        }

        .image-card img {
            width: 100%;
            height: auto;
            border-radius: 8px;
            cursor: crosshair;
        }

        /* Make the original image display smaller and centered */
        #originalImage {
            max-width: 380px;
            width: 100%;
            height: auto;
            display: block;
            margin: 0 auto;
        }
        .image-card img:hover {
            transform: translateY(-2px);
            transition: transform 0.15s ease;
        }

        .values {
            margin-top: 8px;
            padding: 8px;
            background: #fafafa;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
            font-size: 0.95em;
        }

        .value-item {
            padding: 5px 0;
            display: flex;
            justify-content: space-between;
        }

        .value-label {
            font-weight: bold;
            color: #666;
        }

        .value-number {
            color: var(--accent);
            font-weight: 700;
        }

        .info-box {
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border);
            padding: 12px;
            margin: 14px 0;
            border-radius: 10px;
        }

        .pixel-info {
            position: fixed;
            bottom: 16px;
            right: 16px;
            background: var(--card);
            padding: 14px;
            border-radius: 10px;
            border: 1px solid var(--border);
            display: none;
            min-width: 220px;
            backdrop-filter: blur(6px);
        }

        /* Sidebar buttons stack */
        #modeButtons {
            display: none;
        }
        /* Sidebar mode buttons: keep original style; just stack */
        #modeButtons .upload-btn {
            display: block;
            width: 100%;
            margin: 8px 0;
        }
        /* Active mode button: slightly darker accent gradient */
        #modeButtons .upload-btn.active {
            background: linear-gradient(135deg, #1aa0bd 0%, #8a72e8 100%);
            color: #0b0f17;
            border: 1px solid rgba(255,255,255,0.14);
        }
        .sidebar .upload-btn {
            width: 100%;
        }
        .sidebar .upload-box p { margin: 8px 0; }
        @media (max-width: 900px) {
            .layout { flex-direction: column; }
            .sidebar { width: 100%; position: relative; top: 0; }
        }

        .pixel-info h4 {
            margin-bottom: 10px;
            color: #333;
        }

        .color-preview {
            width: 100%;
            height: 50px;
            border-radius: 5px;
            margin: 10px 0;
            border: 2px solid #ddd;
        }
    </style>
</head>
<body>
    <header class="site-header">
        <div class="site-header__inner">
            <h1>Image Channel Converter</h1>
            <p class="subtitle">Upload gambar untuk melihat konversi RGB, HSV, dan YIQ</p>
        </div>
    </header>

    <div class="container">

        <div class="layout">
            <aside class="sidebar">
                <div class="upload-section">
                    <div class="upload-box" id="uploadBox">
                        <p style="margin-bottom: 15px; font-size: 18px;">üìÅ Drag & drop gambar di sini atau</p>
                        <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                            Pilih Gambar
                        </button>
                        <input type="file" id="fileInput" accept="image/*">
                        <p style="margin-top: 15px; color: #666; font-size: 14px;">Format: JPG, PNG, BMP</p>
                    </div>
                </div>
                <div id="modeButtons">
                    <button class="upload-btn" data-mode="rgb" onclick="convertTo('rgb')">Konversi ke RGB</button>
                    <button class="upload-btn" data-mode="hsv" onclick="convertTo('hsv')">Konversi ke HSV</button>
                    <button class="upload-btn" data-mode="yiq" onclick="convertTo('yiq')">Konversi ke YIQ</button>
                </div>
            </aside>

            <main class="content">
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Memproses gambar...</p>
                </div>

                <div class="results" id="results">
                    <div class="section" id="section-original">
                        <h2 class="section-title">Gambar Original</h2>
                        <div class="image-grid">
                            <div class="image-card">
                                <h3>Original Image</h3>
                                <img id="originalImage" alt="Original">
                                <div class="values">
                                    <div class="value-item">
                                        <span class="value-label">Dimensi:</span>
                                        <span class="value-number" id="dimensions"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section" id="section-rgb">
                        <h2 class="section-title">RGB Channels</h2>
                        <div class="info-box">
                            <strong>RGB (Red, Green, Blue)</strong> - Model warna aditif di mana warna dibuat dengan mencampurkan cahaya merah, hijau, dan biru. Nilai setiap channel berkisar dari 0-255.
                        </div>
                        <div class="image-grid">
                            <div class="image-card">
                                <h3>Red Channel</h3>
                                <img id="redChannel" alt="Red Channel">
                                <div class="values">
                                    <div class="value-item">
                                        <span class="value-label">R:</span>
                                        <span class="value-number" id="rValue"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="image-card">
                                <h3>Green Channel</h3>
                                <img id="greenChannel" alt="Green Channel">
                                <div class="values">
                                    <div class="value-item">
                                        <span class="value-label">G:</span>
                                        <span class="value-number" id="gValue"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="image-card">
                                <h3>Blue Channel</h3>
                                <img id="blueChannel" alt="Blue Channel">
                                <div class="values">
                                    <div class="value-item">
                                        <span class="value-label">B:</span>
                                        <span class="value-number" id="bValue"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="section" id="section-hsv">
                        <h2 class="section-title">HSV Channels</h2>
                        <div class="info-box">
                            <strong>HSV (Hue, Saturation, Value)</strong> - Model warna yang lebih intuitif:
                            <br>‚Ä¢ <strong>Hue (0-179)</strong>: Warna dasar (spektrum warna)
                            <br>‚Ä¢ <strong>Saturation (0-255)</strong>: Intensitas warna (0 = abu-abu, 255 = warna penuh)
                            <br>‚Ä¢ <strong>Value (0-255)</strong>: Kecerahan (0 = hitam, 255 = terang)
                        </div>
                        <div class="image-grid">
                            <div class="image-card">
                                <h3>Hue Channel</h3>
                                <img id="hueChannel" alt="Hue Channel">
                                <div class="values">
                                    <div class="value-item">
                                        <span class="value-label">H:</span>
                                        <span class="value-number" id="hValue"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="image-card">
                                <h3>Saturation Channel</h3>
                                <img id="satChannel" alt="Saturation Channel">
                                <div class="values">
                                    <div class="value-item">
                                        <span class="value-label">S:</span>
                                        <span class="value-number" id="sValue"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="image-card">
                                <h3>Value Channel</h3>
                                <img id="valChannel" alt="Value Channel">
                                <div class="values">
                                    <div class="value-item">
                                        <span class="value-label">V:</span>
                                        <span class="value-number" id="vValue"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="image-card">
                                <h3>HSV Combined</h3>
                                <img id="hsvFull" alt="HSV Full">
                            </div>
                        </div>
                    </div>

                    <div class="section" id="section-yiq">
                        <h2 class="section-title">NTSC YIQ Channels</h2>
                        <div class="info-box">
                            <strong>YIQ (NTSC)</strong> - Representasi sinyal video analog:
                            <br>‚Ä¢ <strong>Y</strong>: Luminance (kecerahan)
                            <br>‚Ä¢ <strong>I</strong>: In-phase chrominance (komponen warna)
                            <br>‚Ä¢ <strong>Q</strong>: Quadrature chrominance (komponen warna)
                        </div>
                        <div class="image-grid">
                            <div class="image-card">
                                <h3>Y (Luminance)</h3>
                                <img id="yChannel" alt="Y Channel">
                                <div class="values">
                                    <div class="value-item">
                                        <span class="value-label">Y:</span>
                                        <span class="value-number" id="yValue"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="image-card">
                                <h3>I (Chrominance)</h3>
                                <img id="iChannel" alt="I Channel">
                                <div class="values">
                                    <div class="value-item">
                                        <span class="value-label">I:</span>
                                        <span class="value-number" id="iValue"></span>
                                    </div>
                                </div>
                            </div>
                            <div class="image-card">
                                <h3>Q (Chrominance)</h3>
                                <img id="qChannel" alt="Q Channel">
                                <div class="values">
                                    <div class="value-item">
                                        <span class="value-label">Q:</span>
                                        <span class="value-number" id="qValue"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="image-grid" style="margin-top: 10px;">
                            <div class="image-card">
                                <h3>Y Histogram</h3>
                                <img id="yHist" alt="Y Histogram">
                            </div>
                            <div class="image-card">
                                <h3>I Histogram</h3>
                                <img id="iHist" alt="I Histogram">
                            </div>
                            <div class="image-card">
                                <h3>Q Histogram</h3>
                                <img id="qHist" alt="Q Histogram">
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <div class="pixel-info" id="pixelInfo">
        <h4>Pixel Info</h4>
        <div class="color-preview" id="colorPreview"></div>
        <div class="values">
            <div class="value-item">
                <span class="value-label">Position:</span>
                <span class="value-number" id="pixelPos"></span>
            </div>
            <div class="value-item">
                <span class="value-label">R:</span>
                <span class="value-number" id="pixelR"></span>
            </div>
            <div class="value-item">
                <span class="value-label">G:</span>
                <span class="value-number" id="pixelG"></span>
            </div>
            <div class="value-item">
                <span class="value-label">B:</span>
                <span class="value-number" id="pixelB"></span>
            </div>
            <div class="value-item">
                <span class="value-label">H:</span>
                <span class="value-number" id="pixelH"></span>
            </div>
            <div class="value-item">
                <span class="value-label">S:</span>
                <span class="value-number" id="pixelS"></span>
            </div>
            <div class="value-item">
                <span class="value-label">V:</span>
                <span class="value-number" id="pixelV"></span>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000';
        const fileInput = document.getElementById('fileInput');
        const uploadBox = document.getElementById('uploadBox');
        const loading = document.getElementById('loading');
        const results = document.getElementById('results');
        const modeButtons = document.getElementById('modeButtons');
        let lastFile = null;

        // Handle file input
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                lastFile = e.target.files[0];
                modeButtons.style.display = 'block';
            }
        });

        // Drag and drop
        uploadBox.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadBox.classList.add('dragover');
        });

        uploadBox.addEventListener('dragleave', () => {
            uploadBox.classList.remove('dragover');
        });

        uploadBox.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadBox.classList.remove('dragover');
            if (e.dataTransfer.files.length > 0) {
                uploadImage(e.dataTransfer.files[0]);
            }
        });

        async function convertTo(mode) {
            if (!lastFile) {
                alert('Silakan pilih gambar terlebih dahulu');
                return;
            }
            // Highlight active mode button
            const buttons = document.querySelectorAll('#modeButtons button');
            buttons.forEach(btn => {
                if (btn.dataset.mode === mode) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            loading.style.display = 'block';
            results.style.display = 'none';

            const formData = new FormData();
            formData.append('image', lastFile);
            formData.append('mode', mode);

            try {
                const response = await fetch(`${API_URL}/convert`, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error('Konversi gagal');
                }

                const data = await response.json();
                displayResults(data, mode);
            } catch (error) {
                alert('Error: ' + error.message);
                console.error(error);
            } finally {
                loading.style.display = 'none';
            }
        }

        function displayResults(data, mode) {
            // Original image
            document.getElementById('originalImage').src = `data:image/png;base64,${data.original}`;
            document.getElementById('dimensions').textContent = `${data.dimensions.width} x ${data.dimensions.height}`;

            // Toggle sections
            document.getElementById('section-original').style.display = 'block';
            document.getElementById('section-rgb').style.display = (mode === 'rgb') ? 'block' : 'none';
            document.getElementById('section-hsv').style.display = (mode === 'hsv') ? 'block' : 'none';
            document.getElementById('section-yiq').style.display = (mode === 'yiq') ? 'block' : 'none';

            if (mode === 'rgb' && data.rgb) {
                document.getElementById('redChannel').src = `data:image/png;base64,${data.rgb.r_channel}`;
                document.getElementById('greenChannel').src = `data:image/png;base64,${data.rgb.g_channel}`;
                document.getElementById('blueChannel').src = `data:image/png;base64,${data.rgb.b_channel}`;
                document.getElementById('rValue').textContent = data.rgb.sample_values.r;
                document.getElementById('gValue').textContent = data.rgb.sample_values.g;
                document.getElementById('bValue').textContent = data.rgb.sample_values.b;
            }

            if (mode === 'hsv' && data.hsv) {
                document.getElementById('hueChannel').src = `data:image/png;base64,${data.hsv.h_channel}`;
                document.getElementById('satChannel').src = `data:image/png;base64,${data.hsv.s_channel}`;
                document.getElementById('valChannel').src = `data:image/png;base64,${data.hsv.v_channel}`;
                document.getElementById('hsvFull').src = `data:image/png;base64,${data.hsv.hsv_full}`;
                document.getElementById('hValue').textContent = data.hsv.sample_values.h;
                document.getElementById('sValue').textContent = data.hsv.sample_values.s;
                document.getElementById('vValue').textContent = data.hsv.sample_values.v;
            }

            if (mode === 'yiq' && data.yiq) {
                document.getElementById('yChannel').src = `data:image/png;base64,${data.yiq.y_channel}`;
                document.getElementById('iChannel').src = `data:image/png;base64,${data.yiq.i_channel}`;
                document.getElementById('qChannel').src = `data:image/png;base64,${data.yiq.q_channel}`;
                document.getElementById('yValue').textContent = data.yiq.sample_values.y.toFixed(3);
                document.getElementById('iValue').textContent = data.yiq.sample_values.i.toFixed(3);
                document.getElementById('qValue').textContent = data.yiq.sample_values.q.toFixed(3);
                document.getElementById('yHist').src = `data:image/png;base64,${data.yiq.histograms.y_hist}`;
                document.getElementById('iHist').src = `data:image/png;base64,${data.yiq.histograms.i_hist}`;
                document.getElementById('qHist').src = `data:image/png;base64,${data.yiq.histograms.q_hist}`;
            }

            results.style.display = 'block';
        }

        // Pixel hover info (optional feature)
        document.getElementById('originalImage').addEventListener('mousemove', async (e) => {
            const rect = e.target.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) * (e.target.naturalWidth / rect.width));
            const y = Math.floor((e.clientY - rect.top) * (e.target.naturalHeight / rect.height));
            
            document.getElementById('pixelPos').textContent = `(${x}, ${y})`;
            document.getElementById('pixelInfo').style.display = 'block';
        });

        document.getElementById('originalImage').addEventListener('mouseleave', () => {
            document.getElementById('pixelInfo').style.display = 'none';
        });
    </script>
</body>
</html>